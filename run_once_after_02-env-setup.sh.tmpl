#!/bin/bash

# include global vars and functions
source "${INCLUDES}"

bdb_info_in "Chezmoi init: environment setup"

# set the login shell
bdb_run "Changing the login shell"

# check if zsh is installed
if command -v zsh >/dev/null 2>&1; then

    # check if zsh is already the default shell
    zsh_path="$(which zsh)"
    if [[ "${SHELL}" != "${zsh_path}" ]]; then

        # set zsh as the default shell
        echo "${zsh_path}" | sudo tee -a /etc/shells >/dev/null
        sudo chsh -s "${zsh_path}" "${USER}"
        bdb_outcome "changed to ${zsh_path}"

    else
        bdb_outcome "${zsh_path} is already the default shell"
    fi
else
    bdb_error "ZSH not installed"
fi

{{ if eq .chezmoi.os "linux" -}}
# install JetBrains Mono font
bdb_command "Installing JetBrains Mono font"
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/JetBrains/JetBrainsMono/master/install_manual.sh)"
bdb_success "installing JetBrains Mono font"
{{- end }}

# load bat colorscheme from ~/.config/bat/themes
bdb_command "Setting up bat colorscheme"
{{ if eq .osid "linux-ubuntu" -}}
batcat cache --build
{{ else -}}
bat cache --build
{{ end -}}
bdb_success "setting up bat colorscheme"

bdb_info_out "Chezmoi init: environment setup complete"
